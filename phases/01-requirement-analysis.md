# Phase 1: 需求分析

## 🎯 目标

在动手写代码之前，确保清楚理解需求、约束条件和优先级。

**核心价值：**
- 避免返工和方向错误
- 识别潜在的坑和风险
- 明确验收标准
- 管理预期和范围

---

## 📋 需求分析检查清单

### 必须回答的问题

**基础信息：**
- [ ] **需求来源** - 谁？什么场景？
- [ ] **问题描述** - 当前的问题是什么？
- [ ] **期望结果** - 理想状态是什么样的？
- [ ] **影响范围** - 多少用户/功能受影响？
- [ ] **紧急程度** - Critical/High/Medium/Low？

**约束条件：**
- [ ] **技术约束** - 必须用/不能用什么技术？
- [ ] **时间约束** - 何时需要完成？
- [ ] **资源约束** - 有哪些限制（服务器、预算、人力）？
- [ ] **向后兼容** - 能否破坏现有API/数据？

**验收标准：**
- [ ] **成功标准** - 如何判断做完了？
- [ ] **测试标准** - 需要什么测试？
- [ ] **性能标准** - 响应时间、吞吐量？
- [ ] **安全标准** - 权限、数据保护？

**潜在风险：**
- [ ] **依赖关系** - 依赖哪些外部系统？
- [ ] **数据迁移** - 是否需要迁移数据？
- [ ] **回滚方案** - 如果出问题怎么办？
- [ ] **监控需求** - 需要监控什么指标？

---

## 🎨 需求分类框架

### MoSCoW 方法

| 优先级 | 说明 | 示例 |
|--------|------|------|
| **Must** | 必须有，否则功能不可用 | 用户登录、支付处理 |
| **Should** | 应该有，但可以暂时放下 | 密码强度提示、邮件通知 |
| **Could** | 可以有，如果时间允许 | 导出PDF、深色模式 |
| **Won't** | 明确不做 | 短信验证（用邮件替代） |

**使用场景：**
- 功能需求拆分
- MVP范围确定
- 迭代优先级排序

### 需求类型矩阵

| 类型 | 描述 | 示例Prompt重点 |
|------|------|---------------|
| **Bug修复** | 现有功能不正常 | 错误复现、根因分析 |
| **新功能** | 全新能力 | 用户故事、边界场景 |
| **性能优化** | 改善现有指标 | 基准数据、目标值 |
| **重构** | 改善代码质量 | 架构、可维护性 |
| **安全修复** | 漏洞修补 | 漏洞描述、影响范围 |

---

## 🤝 需求澄清技巧

### AI辅助澄清

**Prompt模板：**

```markdown
我收到了一个需求：[粘贴原始需求]

请帮我分析：
1. 需求的模糊或不明确之处
2. 缺少的关键信息
3. 可能的假设风险
4. 建议询问的问题（按优先级排序）

对于每个问题，说明：
- 为什么需要问
- 如果不问可能导致的后果
- 如何验证得到的答案
```

**示例输出：**

```markdown
## 模糊点

1. **"优化搜索性能"** - 太模糊
   - 当前性能数据是什么？
   - 目标性能是多少？
   - 优化哪个具体场景？

2. **"支持多语言"** - 范围不清
   - 需要支持哪些语言？
   - UI/数据库/日志都需要吗？
   - 如何处理翻译？

3. **"用户友好"** - 主观标准
   - 具体的用户体验指标？
   - 对比哪些竞品？

## 建议询问的问题（优先级）

1. **当前搜索响应时间是多少？目标是多少？** (Critical)
   - 原因：影响优化策略选择
   - 验证：查看APM数据

2. **需要支持哪些语言？中文？英文？其他？** (High)
   - 原因：影响技术方案（i18n库、数据库schema）
   - 验证：查看用户分布数据

3. **"用户友好"指的是什么？易用性？可视化？** (Medium)
   - 原因：影响UI设计方向
   - 验证：参考具体竞品或用户反馈
```

---

## 📝 用户故事模板

### 标准3段式

```
作为一个 [角色]，
我想要 [功能]，
以便于 [价值]。
```

### 完整版（包含验收标准）

```markdown
**用户故事：** US-001 - 搜索结果高亮显示

**描述：**
作为一名用户，
我希望搜索关键词在结果中高亮显示，
以便于快速找到相关内容。

**验收标准：**
- [ ] 搜索关键词在标题和正文中高亮
- [ ] 高亮颜色使用主题色（黄色/蓝色）
- [ ] 支持多个关键词同时高亮
- [ ] 特殊字符（如括号、引号）不破坏高亮
- [ ] 移动端高亮样式可读

**非功能需求：**
- 性能：高亮处理增加 <50ms
- 兼容性：支持Safari, Chrome, Firefox
- 可访问性：符合WCAG 2.1 AA标准

**依赖：**
- 搜索服务已实现（已验收）
- 前端组件库已提供高亮API

**风险：**
- 如果搜索结果非常大，高亮可能影响性能
- 特殊字符处理可能有edge case
```

---

## 🔍 需求分析工作流

### 流程图

```
1. 收集需求 → 2. 初步分析 → 3. 澄清问题 → 4. 验证理解 → 5. 文档化
```

### Step-by-Step

#### Step 1: 收集需求

**输入：**
- 需求文档/邮件/聊天记录
- 相关的issue/ticket
- 截图/原型/参考

**行动：**
- 整合所有相关信息
- 标注关键信息（高亮/加粗）
- 列出疑问点

**AI辅助：**
```markdown
帮我从以下信息中提取关键需求：
[粘贴所有相关信息]

提取格式：
- 核心需求
- 约束条件
- 验收标准
- 潜在问题
```

---

#### Step 2: 初步分析

**检查项：**
- 需求是否完整？
- 是否有冲突？
- 优先级是否明确？
- 技术可行性如何？

**AI辅助：**
```markdown
分析以下需求的完整性：
[需求内容]

检查：
1. 是否符合INVEST原则（独立、可协商、有价值、可估算、短小、可测试）
2. 是否有缺失的验收标准
3. 是否有矛盾的约束条件
4. 估算难度（1-5分）并说明原因
```

---

#### Step 3: 澄清问题

**场景A：需求来源是人（产品经理/用户）**

```markdown
关于[需求名称]，我有几个问题：

1. [问题1]
   - 背景：[为什么问]
   - 影响：[不回答可能导致什么问题]

2. [问题2]
   ...

请提供答案或更多上下文。
```

**场景B：需求来源是模糊描述（如"优化性能"）**

使用AI生成假设选项：
```markdown
需求是"优化搜索性能"，请帮我：

1. 列出3-5个可能的优化方向
2. 每个方向的：
   - 预期效果
   - 工作量估算
   - 风险评估
3. 推荐最合理的方案并说明原因
```

---

#### Step 4: 验证理解

**重述需求：**
```markdown
我理解的需求是：

**核心目标：**
[一句话总结]

**具体要求：**
1. [要求1]
2. [要求2]
3. ...

**约束条件：**
- [约束1]
- [约束2]

**验收标准：**
- [标准1]
- [标准2]

**理解正确吗？如有偏差请纠正。**
```

**AI验证：**
```markdown
我分析了以下需求：
[需求内容]

请检查我的理解是否正确：

## 我的理解

**核心目标：** [总结]

**关键点：**
- [关键点1]
- [关键点2]
- ...

**可能的偏差点：**
- [不确定的点]
- [需要确认的地方]

如果理解有偏差，请指出并纠正。
```

---

#### Step 5: 文档化

**需求文档模板：**

```markdown
# 需求文档：[需求名称]

## 元信息
- **ID：** REQ-001
- **类型：** Bug/Feature/Refactor/Performance/Security
- **优先级：** P0/P1/P2/P3
- **创建日期：** 2026-02-02
- **负责人：** [姓名]

## 需求描述

### 背景
[为什么需要这个需求]

### 问题描述
[当前的问题是什么]

### 期望结果
[理想状态是什么样的]

### 影响范围
- 用户影响：[受影响的用户群]
- 功能影响：[哪些功能受影响]
- 系统影响：[哪些系统受影响]

## 验收标准
- [ ] [标准1]
- [ ] [标准2]
- [ ] [标准3]

## 约束条件
- **技术：** [技术限制]
- **时间：** [时间限制]
- **资源：** [资源限制]
- **兼容性：** [兼容性要求]

## 非功能需求
- **性能：** [性能要求]
- **安全：** [安全要求]
- **可维护性：** [可维护性要求]
- **可扩展性：** [可扩展性要求]

## 依赖关系
- [依赖1]
- [依赖2]

## 风险
- [风险1]
- [风险2]

## 讨论记录
| 日期 | 讨论点 | 决策 | 备注 |
|------|--------|------|------|
| 2026-02-02 | 关于多语言范围 | 先支持中文+英文 | 后续迭代增加更多语言 |

## 附件
- [原型链接]
- [参考文档]
- [相关issue]
```

---

## 🤖 AI Prompt模板库

### 模板1：需求完整性检查

```markdown
请检查以下需求的完整性：

[需求内容]

检查维度：
1. **目标清晰度** - 是否明确说明了要解决的问题？
2. **验收标准** - 是否有明确的成功标准？
3. **约束条件** - 是否说明了技术/时间/资源限制？
4. **风险识别** - 是否识别了潜在风险？
5. **依赖关系** - 是否说明了依赖项？

输出格式：
## 完整性评分：X/10

## 缺失项
1. [缺失项]
   - 建议：[如何补充]

## 需要澄清的问题
1. [问题]
   - 重要性：High/Medium/Low
   - 后果：[不回答可能导致什么]
```

---

### 模板2：需求拆解

```markdown
请将以下需求拆解为可执行的子任务：

[需求描述]

拆解原则：
1. 每个子任务应该独立可验收
2. 子任务之间的依赖关系清晰
3. 估算每个子任务的难度（1-5分）
4. 识别可以并行的任务

输出格式：
## 任务拆解

### 任务1: [任务名称]
- **描述：** [具体描述]
- **验收标准：** [标准]
- **难度：** X/5
- **依赖：** [依赖项]
- **可并行：** Yes/No

### 任务2: ...

## 依赖图
[任务依赖关系图，用文本表示]
```

---

### 模板3：用户故事生成

```markdown
基于以下需求生成用户故事：

[需求描述]

生成格式：
## 用户故事：US-[编号] - [标题]

**描述：**
作为一名 [角色]，
我想要 [功能]，
以便于 [价值]。

**验收标准：**
- [ ] [标准1]
- [ ] [标准2]

**优先级：** Must/Should/Could/Won't

**工作量估算：** [故事点]

**依赖：** [依赖项]

**风险：** [风险]
```

---

### 模板4：需求对比分析

```markdown
对比以下两个需求的相似性和差异：

**需求A：**
[需求A内容]

**需求B：**
[需求B内容]

分析维度：
1. 目标是否相似？
2. 是否有复用方案的可能？
3. 哪个优先级更高？
4. 是否可以合并为一个需求？

输出格式：
## 相似性
- [相同点1]
- [相同点2]

## 差异性
- [差异1]
- [差异2]

## 建议
- [是否合并/单独处理]
- [复用建议]
```

---

## 📊 常见需求陷阱

### 陷阱1：需求蔓延（Scope Creep）

**症状：**
- 功能越加越多
- 原本简单变复杂
- 时间一再延期

**预防：**
- 使用MoSCoW分类
- 明确MVP范围
- 延迟非必要功能到后续迭代

**Prompt：**
```markdown
这个需求的功能越来越多，请帮我：

1. 按MoSCoW分类所有功能
2. 识别MVP最小可行产品范围
3. 建议哪些功能可以延后到2.0/3.0版本

MVP定义：最核心的价值，去掉后产品无法使用。
```

---

### 陷阱2：假设过多

**症状：**
- "用户可能想要..."
- "我觉得应该是..."
- "大概率没问题..."

**预防：**
- 区分"已知"和"假设"
- 主动验证假设
- 提供多个假设选项

**Prompt：**
```markdown
识别以下需求中的假设：

[需求内容]

对每个假设：
1. 标注为"高风险"或"低风险"
2. 提供验证假设的方法
3. 如果假设错误，如何应对

高风险假设 = 如果错误导致返工 > 50%工作量
```

---

### 陷阱3：忽略非功能需求

**症状：**
- 只关注功能实现
- 上线后发现性能/安全问题
- 技术债务积累

**预防：**
- 需求阶段就考虑非功能性需求
- 使用质量属性模型（FURPS+）

**FURPS+ 检查清单：**

| 类别 | 检查项 |
|------|--------|
| **F**unctionality | 功能完整性、准确性、安全性 |
| **U**sability | 易用性、可学习性、可访问性 |
| **R**eliability | 可用性、容错性、可恢复性 |
| **P**erformance | 响应时间、吞吐量、资源使用 |
| **S**upportability | 可维护性、可测试性、可部署性 |
| **+** | 其他（合规性、国际化等） |

---

## ✅ 最佳实践

### 1. 多问几个"为什么"

不要只问"要做什么"，要问"为什么需要它"。

**例子：**
- Q: 需要导出Excel功能
- Q: 为什么需要导出Excel？
- A: 用户需要在本地做数据分析
- Q: 用在线分析可以吗？
- A: 可以，但用户习惯Excel
- → **结论：** 可以先提供在线分析，Excel作为后续功能

### 2. 使用具体数据而非主观描述

❌ Bad: "性能要好"
✅ Good: "响应时间 < 2秒，支持1000并发"

### 3. 用例子而非抽象概念

❌ Bad: "用户友好的错误提示"
✅ Good: "当上传文件失败时，显示'文件太大（最大10MB）'并高亮显示限制"

### 4. 考虑边界情况

❌ Bad: "搜索用户名"
✅ Good: "搜索用户名，支持大小写不敏感、部分匹配、特殊字符"

### 5. 明确"不做"的事情

列出**out of scope**的东西，避免误解：

```markdown
## 不在本次范围内的功能
- 用户注册（已有功能，本次不改）
- 权限管理（后续需求）
- 移动端适配（2.0版本）
```

---

## 📚 参考资料

### 方法论
- **INVEST原则** - 用户故事质量标准
- **MoSCoW方法** - 优先级管理
- **FURPS+** - 质量属性模型
- **5W1H** - 需求收集框架

### 工具
- Confluence/Notion - 需求文档
- Jira/Linear - 需求管理
- Figma/Miro - 原型设计

---

**下一阶段：** [02-solution-design.md](02-solution-design.md)

**回到总览：** [README.md](../README.md)
