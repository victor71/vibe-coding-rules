# 代码审查 Prompt 模板

代码审查的 prompt 模板。

## 场景

- PR 审查
- 代码质量检查
- 安全审计
- 最佳实践检查

## Prompt 模板

```
审查以下代码：[diff 或文件]

重点关注：
- Bug 和潜在问题
- 安全漏洞
- 性能问题
- 代码风格和最佳实践
- 测试覆盖率

对于每个问题：
1. 严重程度：严重/高/中/低
2. 描述：清晰解释
3. 建议修复：尽可能提供代码示例
4. 位置：文件和行号

格式：提供 markdown 报告，每个问题分章节展示。

上下文：
- [相关上下文：例如这是支付代码、面向用户的代码等]
```

## 实际例子

### 例子：审查支付模块 PR

```
审查支付模块的这个 PR。

重点关注：
- 安全：无 API 密钥泄露、正确的验证、无注入风险
- Bug：边界情况、错误处理
- 性能：数据库查询、不必要的循环
- 最佳实践：代码组织、命名、注释

此代码处理真实支付，因此安全性至关重要。

对于每个问题：
1. 严重程度：严重/高/中/低
2. 描述：清晰解释
3. 建议修复：代码示例
4. 位置：文件和行号

以下是 diff：[粘贴 diff]
```

### 例子：全面代码审查

```
审查认证模块（auth_service.py, auth_middleware.py）。

检查：
- 常见安全问题（XSS、CSRF、SQL 注入、认证绕过）
- 错误处理和边界情况
- 性能瓶颈
- 代码重复
- 缺少测试
- 已弃用的 API 或模式

上下文：此模块处理用户认证和会话管理。

提供：
1. 发现总结
2. 关键问题（合并前必须修复）
3. 改进建议
4. 优点（做得好的地方）
```

## 审查维度

### 安全 🔒
- SQL 注入
- XSS
- CSRF
- 认证绕过
- 权限提升
- 敏感信息泄露

### 正确性 🐛
- 边界条件
- 错误处理
- 并发问题
- 数据一致性
- 空值/undefined 处理

### 性能 ⚡
- 不必要的循环
- N+1 查询
- 内存泄漏
- 缺少缓存
- 低效算法

### 可维护性 📝
- 命名清晰
- 注释充分
- 模块化
- DRY（不重复）
- 测试覆盖

## 输出格式

```markdown
# 代码审查报告

## 关键问题（必须修复）
### 问题 #1：SQL 注入风险
- **严重程度**：严重
- **位置**：`auth.py:45`
- **描述**：用户输入直接拼接到 SQL 查询中...
- **修复**：使用参数化查询：
  ```python
  cursor.execute("SELECT * FROM users WHERE id = %s", (user_id,))
  ```

## 高优先级问题
### 问题 #1：缺少错误处理
...

## 中等优先级问题
...

## 低优先级问题
...

## 做得好的地方 🌟
- 类型提示使用得当
- 测试覆盖全面
...
```
